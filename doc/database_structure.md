# 数据库表结构及限制分析

## 1. APPOINTMENTS 表（预约表）
```sql
CREATE CACHED TABLE "PUBLIC"."APPOINTMENTS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    "APPOINTMENT_TIME" TIMESTAMP(6) NOT NULL,
    "SERVICE_TYPE" CHARACTER VARYING(255) NOT NULL,
    "STATUS" CHARACTER VARYING(255) NOT NULL,
    "STUDENT_ID" BIGINT
)
```
**限制**：
- 主键：ID (自增长)
- 外键：STUDENT_ID 引用 USERS(ID)
- 非空字段：ID, APPOINTMENT_TIME, SERVICE_TYPE, STATUS

## 2. PERMISSIONS 表（权限表）
```sql
CREATE CACHED TABLE "PUBLIC"."PERMISSIONS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    "CODE" CHARACTER VARYING(255) NOT NULL,
    "DESCRIPTION" CHARACTER VARYING(255),
    "MODULE" CHARACTER VARYING(255),
    "NAME" CHARACTER VARYING(255) NOT NULL
)
```
**限制**：
- 主键：ID (自增长)
- 唯一约束：CODE
- 非空字段：ID, CODE, NAME

## 3. ROLE_PERMISSIONS 表（角色权限关联表）
```sql
CREATE CACHED TABLE "PUBLIC"."ROLE_PERMISSIONS"(
    "ROLE_ID" BIGINT NOT NULL,
    "PERMISSION_ID" BIGINT NOT NULL
)
```
**限制**：
- 外键：ROLE_ID 引用 ROLES(ID)
- 外键：PERMISSION_ID 引用 PERMISSIONS(ID)
- 非空字段：ROLE_ID, PERMISSION_ID

## 4. ROLES 表（角色表）
```sql
CREATE CACHED TABLE "PUBLIC"."ROLES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    "DESCRIPTION" CHARACTER VARYING(255),
    "NAME" CHARACTER VARYING(255) NOT NULL
)
```
**限制**：
- 主键：ID (自增长)
- 唯一约束：NAME
- 非空字段：ID, NAME

## 5. USERS 表（用户表）
```sql
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    "CLASS_NAME" CHARACTER VARYING(255),
    "CREATE_TIME" TIMESTAMP(6),
    "DEPARTMENT" CHARACTER VARYING(255),
    "EMAIL" CHARACTER VARYING(255),
    "GRADE" INTEGER,
    "LAST_LOGIN_TIME" TIMESTAMP(6),
    "MAJOR" CHARACTER VARYING(255),
    "PASSWORD" CHARACTER VARYING(255) NOT NULL,
    "PHONE" CHARACTER VARYING(255),
    "REAL_NAME" CHARACTER VARYING(255) NOT NULL,
    "STATUS" INTEGER,
    "STUDENT_ID" CHARACTER VARYING(255),
    "TEACHER_ID" CHARACTER VARYING(255),
    "TITLE" CHARACTER VARYING(255),
    "USER_TYPE" CHARACTER VARYING(255),
    "USERNAME" CHARACTER VARYING(255) NOT NULL,
    "ROLE_ID" BIGINT
)
```
**限制**：
- 主键：ID (自增长)
- 外键：ROLE_ID 引用 ROLES(ID)
- 唯一约束：EMAIL
- 唯一约束：USERNAME
- 非空字段：ID, PASSWORD, REAL_NAME, USERNAME

## 6. GRADES 表（成绩表）
```sql
CREATE CACHED TABLE "PUBLIC"."GRADES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    "COMMENT" CHARACTER VARYING(1000),
    "COURSE_CODE" CHARACTER VARYING(255) NOT NULL,
    "COURSE_NAME" CHARACTER VARYING(255) NOT NULL,
    "CREATE_TIME" TIMESTAMP(6) NOT NULL,
    "CREDIT" INTEGER,
    "EXAM_TYPE" CHARACTER VARYING(255) NOT NULL,
    "GRADE_LEVEL" CHARACTER VARYING(255) NOT NULL,
    "SCORE" FLOAT(53) NOT NULL,
    "SEMESTER" CHARACTER VARYING(255) NOT NULL,
    "STATUS" INTEGER NOT NULL,
    "UPDATE_TIME" TIMESTAMP(6) NOT NULL,
    "STUDENT_ID" BIGINT NOT NULL,
    "TEACHER_ID" BIGINT NOT NULL,
    "FINAL_SCORE" FLOAT(53),
    "MIDTERM_SCORE" FLOAT(53),
    "REGULAR_SCORE" FLOAT(53),
    "REMARK" CHARACTER VARYING(255),
    "TOTAL_SCORE" FLOAT(53),
    "COURSE_ID" BIGINT,
    "GRADE" FLOAT(53)
)
```
**限制**：
- 主键：ID (自增长)
- 外键：STUDENT_ID 引用 USERS(ID)
- 外键：TEACHER_ID 引用 USERS(ID)
- 非空字段：ID, COURSE_CODE, COURSE_NAME, CREATE_TIME, EXAM_TYPE, GRADE_LEVEL, SCORE, SEMESTER, STATUS, UPDATE_TIME, STUDENT_ID, TEACHER_ID

## 7. MAKEUP_EXAMS 表（补考表）
```sql
CREATE CACHED TABLE "PUBLIC"."MAKEUP_EXAMS"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    "COMMENT" CHARACTER VARYING(1000),
    "COURSE_CODE" CHARACTER VARYING(255) NOT NULL,
    "COURSE_NAME" CHARACTER VARYING(255) NOT NULL,
    "CREATE_TIME" TIMESTAMP(6) NOT NULL,
    "EXAM_DATE" TIMESTAMP(6) NOT NULL,
    "EXAM_LOCATION" CHARACTER VARYING(255) NOT NULL,
    "MAKEUP_GRADE" CHARACTER VARYING(255),
    "ORIGINAL_GRADE" CHARACTER VARYING(255) NOT NULL,
    "REASON" CHARACTER VARYING(1000),
    "SEMESTER" CHARACTER VARYING(255) NOT NULL,
    "STATUS" CHARACTER VARYING(255) NOT NULL,
    "UPDATE_TIME" TIMESTAMP(6) NOT NULL,
    "STUDENT_ID" BIGINT NOT NULL,
    "TEACHER_ID" BIGINT NOT NULL,
    "APPLY_REASON" CHARACTER VARYING(255),
    "APPLY_TIME" TIMESTAMP(6),
    "APPROVAL_REMARK" CHARACTER VARYING(255),
    "APPROVAL_TIME" TIMESTAMP(6),
    "GRADE_LEVEL" CHARACTER VARYING(255),
    "SCORE" FLOAT(53),
    "ORIGINAL_GRADE_ID" BIGINT NOT NULL
)
```
**限制**：
- 主键：ID (自增长)
- 外键：STUDENT_ID 引用 USERS(ID)
- 外键：TEACHER_ID 引用 USERS(ID)
- 非空字段：ID, COURSE_CODE, COURSE_NAME, CREATE_TIME, EXAM_DATE, EXAM_LOCATION, ORIGINAL_GRADE, SEMESTER, STATUS, UPDATE_TIME, STUDENT_ID, TEACHER_ID, ORIGINAL_GRADE_ID

## 数据库关系总结

1. **用户-角色关系**：USERS 表通过 ROLE_ID 外键关联到 ROLES 表
2. **角色-权限关系**：ROLE_PERMISSIONS 表作为中间表，连接 ROLES 和 PERMISSIONS 表
3. **学生-预约关系**：APPOINTMENTS 表通过 STUDENT_ID 外键关联到 USERS 表
4. **学生-成绩关系**：GRADES 表通过 STUDENT_ID 外键关联到 USERS 表
5. **教师-成绩关系**：GRADES 表通过 TEACHER_ID 外键关联到 USERS 表
6. **学生-补考关系**：MAKEUP_EXAMS 表通过 STUDENT_ID 外键关联到 USERS 表
7. **教师-补考关系**：MAKEUP_EXAMS 表通过 TEACHER_ID 外键关联到 USERS 表

这个数据库设计支持一个校园管理系统，包含用户管理、权限控制、预约管理、成绩管理和补考管理等功能模块。